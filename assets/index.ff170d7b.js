import"./phaser.ab1129a2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class p extends Phaser.GameObjects.Arc{constructor(t,e,s,i){let a=t.getPosition(e,s);super(t,a.x,a.y,i,0,360,!1,0,1),this.i=e,this.j=s,this.r=i;let n=new Phaser.Geom.Circle(this.r/2,this.r/2,this.r);this.setInteractive(n,Phaser.Geom.Circle.Contains),this.on("pointerdown",()=>{this.emit("player_click",this.i,this.j)}),this.isWall=!1,this.scene.add.existing(this)}get isWall(){return this.m_isWall}set isWall(t){this.m_isWall=t,t?this.fillColor=12632256:this.fillColor=8388564}}const o={myconfig:{w:11,h:11,r:20,backgroundColor:16777215,parent:"game",statusBarAlign:"center",credit:"2220631220 \u949F\u4FCA\u6BC5"},animations:[{name:"left_step",textures:["L01","L02","L03","L04","L05"],repeat:0},{name:"top_left_step",textures:["TL01","TL02","TL03","TL04","TL05"],repeat:0},{name:"bottom_left_step",textures:["BL01","BL02","BL03","BL04","BL05"],repeat:0},{name:"left_run",textures:["L02","L03","L04","L05"],repeat:3},{name:"top_left_run",textures:["TL02","TL03","TL04","TL05"],repeat:3},{name:"bottom_left_run",textures:["BL02","BL03","BL04","BL05"],repeat:3}],origins:{left:{x:.75,y:.75},top_left:{x:.63,y:.83},bottom_left:{x:.65,y:.5}},stopTextures:{left:"L01",top_left:"TL01",bottom_left:"BL01"},cannotEscapeTextures:{left:"L02",top_left:"TL02",bottom_left:"BL02"},directions:[{scaleX:1,name:"left"},{scaleX:1,name:"top_left"},{scaleX:-1,name:"top_left"},{scaleX:-1,name:"left"},{scaleX:-1,name:"bottom_left"},{scaleX:1,name:"bottom_left"}],catDefaultDirection:5,catStepLength:20,frameRate:15};class f{constructor(t,e,s,i){this.i=e,this.j=s,this.isWall=i,this.distance=1/0,this.parent=t,this.isEdge=this.i<=0||this.i>=this.parent.w-1||this.j<=0||this.j>=this.parent.h-1}get routesCount(){if(this._routesCount===void 0)if(this.isEdge)this._routesCount=1;else{let t=0;this.neighbours.forEach(e=>{e!==null&&!e.isWall&&e.distance<this.distance&&(t+=e.routesCount)}),this._routesCount=t}return this._routesCount}get neighbours(){if(this._neighbours===void 0){let t=c.getNeighbours(this.i,this.j);this._neighbours=t.map(e=>this.parent.getCell(e.i,e.j))}return this._neighbours}get directions(){let t=[];return this.neighbours.forEach((e,s)=>{e!==null&&!e.isWall&&e.distance<this.distance&&t.push(s)}),t}get direction(){let t=0,e=-1;return this.directions.forEach(s=>{let i=this.neighbours[s];i.routesCount>t&&(t=i.routesCount,e=s)}),e}}class F{constructor(t){if(this.w=t.length,this.w<=0)throw new Error("empty colums");this.h=t[0].length,this.cells=t.map((e,s)=>e.map((i,a)=>new f(this,s,a,t[s][a])))}getCell(t,e){return t>=0&&t<this.w&&e>=0&&e<this.h?this.cells[t][e]:null}BFS(){let t=[];for(this.cells.forEach(e=>{e.forEach(s=>{s._routesCount=void 0,s.isEdge&&!s.isWall&&(s.distance=0,t.push(s))})});t.length>0;){let e=t.shift();e.neighbours.forEach(s=>{s!==null&&!s.isEdge&&!s.isWall&&s.distance>e.distance+1&&(s.distance=e.distance+1,t.indexOf(s)<0&&t.push(s))})}console.log(this.toString())}toString(){let t=[];for(let e=0;e<this.h;e++){let s=[];for(let a=0;a<this.w;a++){let n=this.getCell(a,e);n.isWall?s.push("*"):s.push(n.routesCount)}let i=s.join(" ");(e&1)===1&&(i=" "+i),t.push(i)}return t.join(`
`)}}function y(r,t,e){let s=new F(r);return s.BFS(),s.getCell(t,e).direction}class C extends Phaser.GameObjects.Sprite{constructor(t){super(t,0,0,"L01"),this.on("animationrepeat",()=>{this.moveForward()}),this.main=t,this.solver=y,this.direction=o.catDefaultDirection,this.scene.add.existing(this)}get i(){return this.getData("i")}set i(t){this.setData("i",t)}get j(){return this.getData("j")}set j(t){this.setData("j",t)}get direction(){return this.getData("direction")}set direction(t){this.setData("direction",t),this.resetTextureToStop(),this.resetOriginAndScale()}get solver(){return this.getData("solver")}set solver(t){this.setData("solver",t)}reset(){this.anims.stop(),this.direction=o.catDefaultDirection,this.resetIJ()}step(){let t=this.solver.call(this,this.main.blocksData,this.i,this.j);return t<0||t>6?(this.caught(),!1):this.stepDirection(t)?!0:(this.caught(),!1)}isCaught(){return!this.getCurrentNeighbours().some((t,e)=>{let s=this.main.getBlock(t.i,t.j);return s!==null&&!s.isWall})}caught(){this.setTexture(o.cannotEscapeTextures[o.directions[this.direction].name])}escape(){this.j===0||this.j===this.main.h-1?this.runForward():this.i===0?this.runDirection(0):this.i===this.main.w-1&&this.runDirection(3)}setIJ(t,e){this.i=t,this.j=e;let{x:s,y:i}=this.main.getPosition(t,e);return this.setPosition(s,i)}resetIJ(){this.setIJ(Math.floor(this.main.w/2),Math.floor(this.main.h/2))}isEscaped(){return this.i<=0||this.i>=this.main.w-1||this.j<=0||this.j>=this.main.h-1}checkState(){this.isEscaped()?(this.escape(),this.emit("escaped")):this.isCaught()&&(this.caught(),this.emit("win"))}getCurrentNeighbours(){return c.getNeighbours(this.i,this.j)}resetTextureToStop(){this.setTexture(o.stopTextures[o.directions[this.direction].name])}resetOriginAndScale(){let t=o.directions[this.direction],e=o.origins[t.name];this.setOrigin(e.x,e.y),this.scaleX=t.scaleX}moveForward(){let t=this.getCurrentNeighbours()[this.direction];this.setIJ(t.i,t.j),this.checkState()}stepForward(){let t=this.getCurrentNeighbours()[this.direction],e=this.main.getBlock(t.i,t.j);return e===null||e.isWall?!1:(this.play(o.directions[this.direction].name+"_step"),this.once("animationcomplete",()=>{this.moveForward(),this.resetTextureToStop()}),!0)}stepDirection(t){return this.direction=t,this.stepForward()}runForward(){this.play(o.directions[this.direction].name+"_run")}runDirection(t){this.direction=t,this.runForward()}}class B extends Phaser.GameObjects.Text{constructor(t){super(t,0,0,"",{}),this.setColor("#36D1C7"),this.setPosition(t.game.canvas.width,t.game.canvas.height),this.setOrigin(1,1);let e=30;this.setFontSize(e*.8),this.setPadding(e,e,e,e),this.setText(o.myconfig.credit),this.scene.add.existing(this)}}class x extends Phaser.GameObjects.Text{constructor(t){super(t,0,0,"",{}),this.setColor("#741B7C");let e=t.r;this.setFontSize(e),this.setX(t.game.canvas.width/2),this.setOrigin(.5,0),this.setPadding(e,e,e,e),this.scene.add.existing(this)}}class b extends Phaser.GameObjects.Text{constructor(t){super(t,0,0,"\u5982\u679C\u80FD\u91CD\u6765",{}),this.setColor("#75FA8D");let e=t.r;this.setFontSize(e),this.setPadding(e,e,e,e),this.setPosition(0,t.game.canvas.height),this.setOrigin(0,1);let s=new Phaser.Geom.Rectangle(0,0,this.width,this.height);this.setInteractive(s,Phaser.Geom.Rectangle.Contains),this.scene.add.existing(this)}}class c extends Phaser.Scene{constructor(t,e,s){super({key:"PlayScene"}),this.w=t,this.h=e,this.r=s,this.dx=this.r*2,this.dy=this.r*Math.sqrt(3)}preload(){this.load.pack("pack1","./assets/pack.json","cat"),this.load.setPath("assets"),this.load.image("img2","ll.png"),this.load.image("img3","Ultraman.png"),this.load.audio("\u53EE","\u53EE.mp3"),this.load.audio("\u6E38\u620F\u5931\u8D25","\u6E38\u620F\u5931\u8D25.mp3"),this.load.audio("\u5899","\u5899.mp3"),this.load.audio("\u55B5\u55B5\u55B5","\u55B5\u55B5\u55B5.mp3"),this.load.audio("\u6210\u529F\u6293\u4F4F\u5C0F\u732B","\u6210\u529F\u6293\u4F4F\u5C0F\u732B.mp3"),this.load.audio("\u597D\u8FD0\u6765","\u597D\u8FD0\u6765.mp3")}init(){console.log("init")}get cat(){return this.data.get("cat")}set cat(t){this.data.set("cat",t)}get statusBar(){return this.data.get("status_bar")}set statusBar(t){this.data.set("status_bar",t)}get creditText(){return this.data.get("credit_text")}set creditText(t){this.data.set("credit_text",t)}get state(){return this.data.get("state")}set state(t){switch(t){case"playing":break;case"lose":this.setStatusText("\u732B\u5DF2\u7ECF\u8DD1\u5230\u5730\u56FE\u8FB9\u7F18\u4E86\uFF0C\u4F60\u8F93\u4E86"),this.sound.play("\u6E38\u620F\u5931\u8D25"),this.scene.launch("EndGame"),this.scene.bringToTop("EndGame");break;case"win":this.setStatusText("\u732B\u5DF2\u7ECF\u65E0\u8DEF\u53EF\u8D70\uFF0C\u4F60\u8D62\u4E86"),this.sound.play("\u6210\u529F\u6293\u4F4F\u5C0F\u732B"),this.scene.launch("VictoryGame"),this.scene.bringToTop("VictoryGame");break;default:return}this.data.set("state",t)}static getNeighbours(t,e){let s={i:t-1,j:e},i={i:t+1,j:e},a,n,l,u;(e&1)===0?(a={i:t-1,j:e-1},n={i:t,j:e-1},l={i:t-1,j:e+1},u={i:t,j:e+1}):(a={i:t,j:e-1},n={i:t+1,j:e-1},l={i:t,j:e+1},u={i:t+1,j:e+1});let h=[];return h[0]=s,h[1]=a,h[2]=n,h[3]=i,h[4]=u,h[5]=l,h}reset(){this.cat.reset(),this.resetBlocks(),this.state="playing",this.setStatusText("\u70B9\u51FB\u5C0F\u5706\u70B9\uFF0C\u56F4\u4F4F\u5C0F\u732B")}playerClick(t,e){if(this.cat.anims.isPlaying&&this.cat.anims.stop(),this.state!=="playing")return this.setStatusText("\u6E38\u620F\u5DF2\u7ECF\u7ED3\u675F\uFF0C\u91CD\u65B0\u5F00\u5C40"),this.reset(),!1;let s=this.getBlock(t,e);return s?s.isWall?(this.setStatusText("\u70B9\u51FB\u4F4D\u7F6E\u5DF2\u7ECF\u662F\u5899\u4E86\uFF0C\u7981\u6B62\u70B9\u51FB"),this.sound.play("\u5899"),!1):this.cat.i===t&&this.cat.j===e?(this.setStatusText("\u70B9\u51FB\u4F4D\u7F6E\u662F\u732B\u5F53\u524D\u4F4D\u7F6E\uFF0C\u7981\u6B62\u70B9\u51FB"),this.sound.play("\u55B5\u55B5\u55B5"),!1):(s.isWall=!0,this.cat.isCaught()?(this.setStatusText("\u732B\u5DF2\u7ECF\u65E0\u8DEF\u53EF\u8D70\uFF0C\u4F60\u8D62\u4E86"),this.state="win",!1):(this.setStatusText(`\u70B9\u51FB\u4F4D\u7F6E (\u884C: ${e+1}\uFF0C\u5217:${t+1})`),this.cat.step()||(this.setStatusText("\u732B\u8BA4\u8F93\uFF0C\u4F60\u8D62\u4E86\uFF01"),this.state="win"),!0)):(this.setStatusText("\u4EE3\u7801\u9519\u8BEF\uFF0C\u5F53\u524D\u4F4D\u7F6E\u4E0D\u5B58\u5728"),!1)}setStatusText(t){this.statusBar.setText(t)}get blocks(){return this.data.get("blocks")}set blocks(t){this.data.set("blocks",t)}get blocksData(){let t=[];return this.blocks.forEach((e,s)=>{t[s]=[],e.forEach((i,a)=>{t[s][a]=i.isWall})}),this.sound.play("\u53EE"),this.emitter1.setVisible(!0),t}create(){console.log("create"),this.add.image(300,300,"img3"),this.creditText=new B(this),this.statusBar=new x(this),new b(this).on("pointerup",()=>{this.reset(),this.sound.play("\u597D\u8FD0\u6765")}),this.createAnimations(),this.createBlocks(),this.createCat(),this.reset();var e=this.add.particles("img2");e.createEmitter({speed:{min:120,max:520},lifespan:1e3,quantity:10,scale:{min:.1,max:.3},alpha:{start:1,end:0},blendMode:"ADD"})}getPosition(t,e){return{x:this.r*3+((e&1)===0?this.r:this.dx)+t*this.dx,y:this.r*3+this.r+e*this.dy}}getBlock(t,e){return t>=0&&t<this.w&&e>=0&&e<this.h?this.blocks[t][e]:null}randomWall(){for(let t=0;t<8;t++){let e=Math.floor(this.w*Math.random()),s=Math.floor(this.h*Math.random());if(e!==this.cat.i||s!==this.cat.j){let i=this.getBlock(e,s);i&&(i.isWall=!0)}}}createAnimations(){o.animations.forEach(t=>{let e=[];t.textures.forEach(s=>{e.push({key:s,frame:0})}),this.anims.create({key:t.name,frames:e,frameRate:o.frameRate,repeat:t.repeat})})}createCat(){let t=new C(this);t.on("escaped",()=>{this.state="lose"}),t.on("win",()=>{this.state="win"}),this.cat=t;const e=this.add.particles("img2");this.emitter1=e.createEmitter({speed:100,scale:{start:0,end:.1},blendMode:"ADD"}),this.emitter1.setVisible(!1),this.emitter1.startFollow(this.cat)}resetBlocks(){this.blocks.forEach(t=>{t.forEach(e=>{e.isWall=!1})}),this.randomWall()}createBlocks(){let t=[];for(let e=0;e<this.w;e++){t[e]=[];for(let s=0;s<this.h;s++){let i=new p(this,e,s,this.r*.9);t[e][s]=i,i.on("player_click",this.playerClick.bind(this))}}this.blocks=t}update(){this.cat.anims.isPlaying||this.emitter1.setVisible(!1)}}class E extends Phaser.Scene{constructor(){super("StartGame")}preload(){this.load.setPath("assets"),this.load.image("gamename","gamename.jpg"),this.load.image("playbutton","play.jpg")}create(){this.gamename=this.add.image(400,400,"gamename"),this.playbutton=this.add.image(440,730,"playbutton").setInteractive(),this.playbutton.on("pointerdown",t=>{this.scene.start("PlayScene")})}}class w extends Phaser.Scene{constructor(){super("EndGame")}preload(){this.load.setPath("assets"),this.load.image("gameover","gameover.jpg"),this.load.image("playbutton2","play.jpg")}create(){this.gameover=this.add.image(400,400,"gameover"),this.playbutton2=this.add.image(440,730,"playbutton2").setInteractive(),this.playbutton2.on("pointerdown",t=>{this.scene.stop("PlayScene"),this.scene.start("StartGame")})}}class D extends Phaser.Scene{constructor(){super("VictoryGame")}preload(){this.load.setPath("assets"),this.load.image("victorygame","victorygame.jpg"),this.load.image("playbutton","play.jpg")}create(){this.victorygame=this.add.image(400,400,"victorygame"),this.playbutton=this.add.image(440,730,"playbutton").setInteractive(),this.playbutton.on("pointerdown",t=>{this.scene.stop("PlayScene"),this.scene.start("StartGame")})}}class T extends Phaser.Game{constructor(t){let e=t.w,s=t.h,i=t.r*window.devicePixelRatio,a=1/window.devicePixelRatio,n=Math.floor((6.5+2*e)*i),l=Math.floor((6+Math.sqrt(3)*s)*i),u=new c(e,s,i),h=new E,d=new w,m=new D;const g={width:n,height:l,type:Phaser.AUTO,parent:t.parent,backgroundColor:t.backgroundColor,scene:[h,u,m,d],zoom:a};super(g),this.mainScene=u,this.StartGame=h,this.VictoryScene=m,this.EndScene=d}}window.addEventListener("load",()=>{new T(o.myconfig)});
